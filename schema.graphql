enum FungibleTokenType {
  External
  Point
  Base
}

type FungibleTokenMetadata @entity {
  id: ID!
  URI: String!
  createdAt: BigInt!
  createdAtBlock: BigInt!
  updatedAt: BigInt!
  updatedAtBlock: BigInt!
}

# Performant many to many relationship of App and fungibleToken, see https://thegraph.com/docs/en/developing/creating-a-subgraph/#example-1
type AppFungibleToken @entity {
  id: ID!
  app: App!
  token: FungibleToken!
}

type FungibleToken @entity {
  id: ID!
  name: String!
  owner: User!
  symbol: String!
  decimals: Int!
  metadata: FungibleTokenMetadata
  tokenType: FungibleTokenType!
  """
  DEPRECATED: The `app` field has been deprecated as app-token is a many to many relationship, please use `apps` instead.
  """
  app: App @deprecated(reason: "The `app` field has been deprecated as app-token is a many to many relationship, please use `apps` instead.")
  apps: [AppFungibleToken!] @derivedFrom(field: "token")
  totalSupply: BigInt!
  burntSupply: BigInt!
  createdAt: BigInt!
  createdAtBlock: BigInt!
  updatedAt: BigInt!
  updatedAtBlock: BigInt!
}

type FungibleTokenBalance @entity {
  id: ID!
  user: User!
  token: FungibleToken!
  balance: BigInt!
  createdAt: BigInt!
  createdAtBlock: BigInt!
  updatedAt: BigInt!
  updatedAtBlock: BigInt!
}

type App @entity {
  id: ID!
  name: String!
  metadata: AppMetadata
  owner: User!
  xpToken: FungibleToken
  badges: [Badge!] @derivedFrom(field: "app")
  badgeCount: BigInt!
  badgesAwarded: BigInt!
  tokens: [AppFungibleToken!] @derivedFrom(field: "app")
  requiredTokenBalance: [RequiredTokenBalance!] @derivedFrom(field: "app")
  createdAt: BigInt!
  createdAtBlock: BigInt!
  updatedAt: BigInt!
  updatedAtBlock: BigInt!
}

type AppMetadata @entity {
  id: ID!
  name: String!
  description: String!
  URI: String!
  createdAt: BigInt!
  createdAtBlock: BigInt!
}

type AppRewardId @entity (immutable: true) {
  id: ID!
  app: App!
  rewardId: String!
  createdAt: BigInt!
  createdAtBlock: BigInt!
}

type RequiredTokenBalance @entity {
  id: ID!
  app: App!
  token: FungibleToken!
  balance: BigInt!
  createdAt: BigInt!
  createdAtBlock: BigInt!
  updatedAt: BigInt!
  updatedAtBlock: BigInt!
}

type BadgeToken @entity {
  id: ID!
  tokenId: BigInt!
  badge: Badge!
  metadataURI: String
  owner: User
  createdAt: BigInt!
  createdAtBlock: BigInt!
  updatedAt: BigInt!
  updatedAtBlock: BigInt!
}

type Badge @entity {
  id: ID!
  name: String!
  symbol: String!
  metadataURI: String
  tokens: [BadgeToken!] @derivedFrom(field: "badge")
  app: App!
  royaltyBps: BigInt!
  royaltyRecipient: Bytes!
  totalAwarded: BigInt!
  totalAvailable: BigInt!
  createdAt: BigInt!
  createdAtBlock: BigInt!
  updatedAt: BigInt!
  updatedAtBlock: BigInt!
}

type User @entity {
  id: ID!
  tokenBalances: [FungibleTokenBalance!] @derivedFrom(field: "user")
  collectedBadges: [BadgeToken!] @derivedFrom(field: "owner")
  createdAt: BigInt!
  createdAtBlock: BigInt!
  updatedAt: BigInt!
  updatedAtBlock: BigInt!
}

type UserReward @entity (immutable: true) {
  id: ID!
  createdAt: BigInt!
  createdAtBlock: BigInt!
}

type UserRewardData @entity(timeseries: true) {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  userId: String!
}

type UserRewardAppStat @aggregation(intervals: ["hour", "day"], source: "UserRewardData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
}

type Reward @entity (immutable: true) {
  id: ID!
  app: App!
  rewardId: String!
  rewardType: String!
  metadataURI: String!
  user: User!
  token: FungibleToken
  tokenAmount: BigInt!
  badge: Badge
  badgeTokens: [BadgeToken!]
  badgeCount: Int!
  transactionHash: String!
  createdAt: BigInt!
  createdAtBlock: BigInt!
}

type RewardData @entity(timeseries: true){
  id: Int8!
  timestamp: Timestamp!
  
  appId: String!
  userId: String!
  rewardId: String!
  rewardType: String!
  transactionHash: String!

  tokenId: String
  tokenAmount: BigInt!
  
  badgeId: String
  badgeTokenCount: Int!

  metadataURI: String!
}

type RewardTokenData @entity(timeseries: true){
  id: Int8!
  timestamp: Timestamp!
  
  appId: String!
  userId: String!
  rewardId: String!
  rewardType: String!
  transactionHash: String!
  
  tokenId: String
  tokenAmount: BigInt!
  metadataURI: String!
}

type RewardBadgeData @entity(timeseries: true){
  id: Int8!
  timestamp: Timestamp!
  
  appId: String!
  userId: String!
  rewardId: String!
  rewardType: String!
  transactionHash: String!
  
  badgeId: String
  badgeTokenCount: Int!
  metadataURI: String!
}

type RewardAppStat @aggregation(intervals: ["hour", "day"], source: "RewardData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
}

type RewardAppRewardIdStat @aggregation(intervals: ["hour", "day"], source: "RewardData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  rewardId: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
}

type RewardAppRewardTypeStat @aggregation(intervals: ["hour", "day"], source: "RewardData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  rewardType: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
}

type RewardAppRewardIdRewardTypeStat @aggregation(intervals: ["hour", "day"], source: "RewardData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  rewardId: String!
  rewardType: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
}

type RewardAppUserStat @aggregation(intervals: ["hour", "day"], source: "RewardData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  userId: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
}

type RewardAppUserRewardTypeStat @aggregation(intervals: ["hour", "day"], source: "RewardData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  userId: String!
  rewardType: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
}

type RewardAppUserRewardIdStat @aggregation(intervals: ["hour", "day"], source: "RewardData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  userId: String!
  rewardId: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
}

type RewardAppUserRewardIdRewardTypeStat @aggregation(intervals: ["hour", "day"], source: "RewardData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  userId: String!
  rewardId: String!
  rewardType: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
}

type RewardAppTokenTypeStat @aggregation(intervals: ["hour", "day"], source: "RewardTokenData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
}

type RewardAppTokenTypeUserStat @aggregation(intervals: ["hour", "day"], source: "RewardTokenData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  userId: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
}

type RewardAppTokenStat @aggregation(intervals: ["hour", "day"], source: "RewardTokenData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  tokenId: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
  tokenAmount: BigInt! @aggregate(fn: "sum", arg: "tokenAmount")
  totalTokenAmount: BigInt! @aggregate(fn: "sum", arg: "tokenAmount", cumulative: true)
}

type RewardAppTokenUserStat @aggregation(intervals: ["hour", "day"], source: "RewardTokenData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  tokenId: String!
  userId: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
  tokenAmount: BigInt! @aggregate(fn: "sum", arg: "tokenAmount")
  totalTokenAmount: BigInt! @aggregate(fn: "sum", arg: "tokenAmount", cumulative: true)
}

type RewardAppBadgeTypeStat @aggregation(intervals: ["hour", "day"], source: "RewardBadgeData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
  badgeTokenAmount: BigInt! @aggregate(fn: "sum", arg: "badgeTokenCount")
  totalBadgeTokenAmount: BigInt! @aggregate(fn: "sum", arg: "badgeTokenCount", cumulative: true)
}

type RewardAppBadgeTypeUserStat @aggregation(intervals: ["hour", "day"], source: "RewardBadgeData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  userId: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
  badgeTokenAmount: BigInt! @aggregate(fn: "sum", arg: "badgeTokenCount")
  totalBadgeTokenAmount: BigInt! @aggregate(fn: "sum", arg: "badgeTokenCount", cumulative: true)
}

type RewardAppBadgeStat @aggregation(intervals: ["hour", "day"], source: "RewardBadgeData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  badgeId: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
  badgeTokenAmount: BigInt! @aggregate(fn: "sum", arg: "badgeTokenCount")
  totalBadgeTokenAmount: BigInt! @aggregate(fn: "sum", arg: "badgeTokenCount", cumulative: true)
}

type RewardAppBadgeUserStat @aggregation(intervals: ["hour", "day"], source: "RewardBadgeData") {
  id: Int8!
  timestamp: Timestamp!
  appId: String!
  badgeId: String!
  userId: String!
  count: Int8! @aggregate(fn: "count")
  totalCount: Int8! @aggregate(fn: "count", cumulative: true)
  badgeTokenAmount: BigInt! @aggregate(fn: "sum", arg: "badgeTokenCount")
  totalBadgeTokenAmount: BigInt! @aggregate(fn: "sum", arg: "badgeTokenCount", cumulative: true)
}

"""
DEPRECATED: The `Action` entity has been deprecated as please query the `Reward` entity with `rewardType: "ACTION"` instead.
"""
type Action @entity {
  id: ID!
  metadata: ActionMetadata
  app: App
  user: User!
  xp_rewarded: BigInt!
  createdAt: BigInt!
  createdAtBlock: BigInt!
}

"""
DEPRECATED: The `ActionMetadata` entity has been deprecated as please query the `Reward` with `rewardType: "ACTION"` instead.
"""
type ActionMetadata @entity {
  id: ID!
  name: String
  URI: String!
}

"""
DEPRECATED: The `MissionFungibleToken` entity has been deprecated as please query the `Reward` entity instead.
"""
type MissionFungibleToken @entity {
  id: ID!
  token: FungibleToken!
  mission: Mission!
  amount_rewarded: BigInt!
}

"""
DEPRECATED: The `MissionMetadata` entity has been deprecated as please query the `Reward` entity with `rewardType: "MISSION"` instead.
"""
type MissionMetadata @entity {
  id: ID!
  name: String
  URI: String!
}

"""
DEPRECATED: The `Mission` entity has been deprecated as please query the `Reward` entity with `rewardType: "MISSION"` instead.
"""
type Mission @entity {
  id: ID!
  metadata: MissionMetadata
  app: App
  user: User
  xp_rewarded: BigInt!
  badges: [BadgeToken!]!
  tokens: [MissionFungibleToken!] @derivedFrom(field: "mission")
  createdAt: BigInt!
  createdAtBlock: BigInt!
}

type Charge @entity(immutable: true) {
  id: ID!
  app: App!
  user: User!
  token: FungibleToken!
  amount: BigInt!
  chargeId: String!
  chargeType: String!
  createdAt: BigInt!
  createdAtBlock: BigInt!
}